{"componentChunkName":"component---src-templates-post-template-tsx","path":"/amplify-android-pinpoint/","result":{"data":{"markdown":{"frontmatter":{"slug":"/amplify-android-pinpoint/","date":"2020.01.25","tags":["AWS","Android"],"title":"AmplifyとAndroidでPush通知","description":"awsのamplifyとandroidの連携方法をまとめたtutorial。Cognitoでユーザー管理、S3でファイル保存、PinpointとLambdaでPush通知という流れ。この投稿はその第三弾です。","thumbnail":{"name":"android-amplify-thumbnail","publicURL":"/static/5935bbe91d8b29516cdc571efaa03cbb/android-amplify-thumbnail.png"}},"html":"<h2 id=\"これは何\" style=\"position:relative;\"><a href=\"#%E3%81%93%E3%82%8C%E3%81%AF%E4%BD%95\" aria-label=\"これは何 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>これは何</h2>\n<p>AWS Amplifyを用いて、ログイン、画像アップロード、push通知シリーズ第三弾の投稿です。<br>\n第二弾の投稿は以下をご覧ください。</p>\n<p><a href=\"https://www.takigawa-memo.com/amplify-android-s3/\">AmplifyとAndroidでファイル保存 - TAKIGAWA MEMO</a></p>\n<p>第二弾ではCognitoから取得したcredentialを利用してS3に画像をアップロードするところまで終了しました。<br>\n今回は、S3に画像をアップロードしたタイミングで、push通知配信先に登録されている全てのデバイスに対してpush通知を送信する機能を追加したいと思います。</p>\n<p>前回に引き続きAmplifyTutorialアプリに機能を追加していきます。</p>\n<h2 id=\"firebaseプロジェクトを作成\" style=\"position:relative;\"><a href=\"#firebase%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90\" aria-label=\"firebaseプロジェクトを作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>firebaseプロジェクトを作成</h2>\n<p>Androidでpush通知を実現するためには、<a href=\"https://firebase.google.com/docs/cloud-messaging?hl=ja\">Firebase Cloud Messaging</a>というサービスにpush通知を依頼する必要があります。<br>\nそのためにまずは、アプリに固有のfirebaseプロジェクトを作成しましょう。firebaseプロジェクトの作成方法については以下のサイトが参考になります。</p>\n<p><a href=\"https://firebase.google.com/docs/projects/learn-more?hl=ja\">Firebase プロジェクトについて理解する</a><br>\n<a href=\"https://firebase.google.com/docs/android/setup?hl=ja\">Android プロジェクトに Firebase を追加する</a></p>\n<p>全ての設定が終了した後、アプリをビルドすると、Firebaseコンソール画面のアナリティクスのDashboadにてエンドポイントの情報が登録されていることが確認できます。</p>\n<h2 id=\"amplifyにanalytics機能を追加\" style=\"position:relative;\"><a href=\"#amplify%E3%81%ABanalytics%E6%A9%9F%E8%83%BD%E3%82%92%E8%BF%BD%E5%8A%A0\" aria-label=\"amplifyにanalytics機能を追加 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AmplifyにAnalytics機能を追加</h2>\n<p>AmplifyにAnalyticsカテゴリを追加すると、AWSのバックエンドにPinpointというサービスのリソースが作成されます。<br>\nAWSの公式ドキュメントではPinpointを以下のように説明しています。</p>\n<blockquote>\n<p>Amazon Pinpoint は、複数のメッセージングチャネルをまたがってお客様とやり取りするための AWS 製品です。Amazon Pinpoint を使用して、プッシュ通知、E メール、SMS テキストメッセージ、または音声メッセージを送信できます。</p>\n<p><a href=\"https://docs.aws.amazon.com/ja_jp/pinpoint/latest/developerguide/welcome.html\">AWS - Amazon Pinpoint とは</a></p>\n</blockquote>\n<p>AWS Simple Notification ServcieもAWSのプッシュ通知配信サービスとして知られていますが、Pinpointはメッセージテンプレートや、配信スケジュール、セグメント、などユーザーにメッセージを送るためのより高度な機能が追加されています。</p>\n<p>AmplifyにAnalytics機能を追加するために以下のコマンドを実行しましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ amplify <span class=\"token function\">add</span> analytics \nUsing service: Pinpoint, provided by: awscloudformation\n? Provide your pinpoint resource name: amplifytutorial\nAdding analytics would <span class=\"token function\">add</span> the Auth category to the project <span class=\"token keyword\">if</span> not already added.\n? Apps need authorization to send analytics events. Do you want to allow guests and unauthenticated <span class=\"token function\">users</span> to send analytics events? <span class=\"token punctuation\">(</span>we recommend you allow this when getting started<span class=\"token punctuation\">)</span> Yes</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>次に、AmplifyにNotificationカテゴリを追加し、FCMをpush通知先として設定します。<br>\nApiKeyの取得方法は以下のサイトが参考になります。</p>\n<p><a href=\"https://aws-amplify.github.io/docs/sdk/android/push-notifications-setup-fcm\">Android SDK - Setting Up FCM/GCM for Push Notifications</a></p>\n<p>以下のコマンドを実行しましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ amplify <span class=\"token function\">add</span> notifications\n? Choose the push notification channel to enable. FCM\n? ApiKey <span class=\"token operator\">&lt;</span>server key<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>変更をクラウド側にpushします。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ amplify push</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Pinpointのtokyoリージョンでのサービスが、この記事の投稿時点ではまだ開始されていないので、us-west-2にリソースが作成されると思います。\n以下のコマンドでコンソールを開くことができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ amplify analytics console</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"android側の実装\" style=\"position:relative;\"><a href=\"#android%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85\" aria-label=\"android側の実装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Android側の実装</h2>\n<p>次はandroid側の実装に移ります。</p>\n<h3 id=\"gradleに依存関係を追加\" style=\"position:relative;\"><a href=\"#gradle%E3%81%AB%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E8%BF%BD%E5%8A%A0\" aria-label=\"gradleに依存関係を追加 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gradleに依存関係を追加</h3>\n<p>適当なライブラリを依存関係に含めます。</p>\n<div class=\"gatsby-code-title\">build.gradle(app)</div>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-groovy line-numbers\"><code class=\"language-groovy\">dependencies <span class=\"token punctuation\">{</span>\n    implementation <span class=\"token string\">'com.amplifyframework:aws-analytics-pinpoint:0.9.0'</span>\n    implementation <span class=\"token interpolation-string\"><span class=\"token string\">\"com.amazonaws:aws-android-sdk-pinpoint:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">aws_sdk_version</span></span><span class=\"token string\">\"</span></span>\n\n    implementation <span class=\"token string\">'com.google.firebase:firebase-core:17.2.0'</span>\n    implementation <span class=\"token string\">'com.google.firebase:firebase-messaging:20.1.0'</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"androidmanifestファイルに設定を追加\" style=\"position:relative;\"><a href=\"#androidmanifest%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0\" aria-label=\"androidmanifestファイルに設定を追加 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AndroidManifestファイルに設定を追加</h3>\n<p>AndroidManifestファイルにServiceとReceiverを追加します。\nServiceはFCMから送られてきたメッセージを受け取るための、Receiverはアプリがバックグラウンド状態時にpush通知がタップされた場合にアプリが起動されるためのものです。</p>\n<div class=\"gatsby-code-title\">AndroidManifest.xml</div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-xml line-numbers\"><code class=\"language-xml\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>application</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>service</span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>.PushListenerService<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.google.firebase.MESSAGING_EVENT<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>service</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>receiver</span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.amazonaws.mobileconnectors.pinpoint.targeting.notification.PinpointNotificationReceiver<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.amazonaws.intent.fcm.NOTIFICATION_OPEN<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>receiver</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>application</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"awsutilsクラスを変更\" style=\"position:relative;\"><a href=\"#awsutils%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4\" aria-label=\"awsutilsクラスを変更 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWSUtilsクラスを変更</h3>\n<p>AWSUtilsクラスを変更し、AmplifyにAmazonPipointPluginを追加します。<br>\nまた後々、PushListenerServiceクラスからPinpointManagerにアクセスする必要が出てくるので、そのためのメソッドも追加します。<br>\n変更後のAWSUtilsクラスは以下の通りです。</p>\n<div class=\"gatsby-code-title\">AWSUtils.kt</div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>amplifytutorial\n\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>Context\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Log\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobile<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>AWSMobileClient\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobile<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>Callback\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobile<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>UserStateDetails\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobile<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>AWSConfiguration\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobileconnectors<span class=\"token punctuation\">.</span>pinpoint<span class=\"token punctuation\">.</span>PinpointConfiguration\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobileconnectors<span class=\"token punctuation\">.</span>pinpoint<span class=\"token punctuation\">.</span>PinpointManager\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amplifyframework<span class=\"token punctuation\">.</span>analytics<span class=\"token punctuation\">.</span>pinpoint<span class=\"token punctuation\">.</span>AmazonPinpointAnalyticsPlugin\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amplifyframework<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>Amplify\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amplifyframework<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>s3<span class=\"token punctuation\">.</span>AWSS3StoragePlugin\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>CountDownLatch\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>TimeUnit\n\n<span class=\"token keyword\">object</span> AWSUtils <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> INITIALIZATION_TIMEOUT_MS <span class=\"token operator\">=</span> <span class=\"token number\">2000L</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> TAG <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"AWSUtils\"</span></span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> LOCK <span class=\"token operator\">=</span> <span class=\"token function\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> configured <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> pinpointManager<span class=\"token operator\">:</span> PinpointManager<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">initAWSMobileClient</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">synchronized</span><span class=\"token punctuation\">(</span>LOCK<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>configured<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"already configured\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">val</span> mobileClientLatch <span class=\"token operator\">=</span> <span class=\"token function\">CountDownLatch</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            AWSMobileClient<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">,</span> <span class=\"token keyword\">object</span> <span class=\"token operator\">:</span> Callback<span class=\"token operator\">&lt;</span>UserStateDetails<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onResult</span><span class=\"token punctuation\">(</span>userStateDetails<span class=\"token operator\">:</span> UserStateDetails<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        mobileClientLatch<span class=\"token punctuation\">.</span><span class=\"token function\">countDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">}</span>\n\n                    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> Exception<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        Log<span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"Initialization error.\"</span></span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mobileClientLatch<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span>\n                        INITIALIZATION_TIMEOUT_MS<span class=\"token punctuation\">,</span>\n                        TimeUnit<span class=\"token punctuation\">.</span>MILLISECONDS\n                    <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token function\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Failed to initialize mobile client.\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>exception<span class=\"token operator\">:</span> Exception<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">exception<span class=\"token punctuation\">.</span>message</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n\n            configured <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">configureAmplifyPlugin</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            Amplify<span class=\"token punctuation\">.</span><span class=\"token function\">addPlugin</span><span class=\"token punctuation\">(</span><span class=\"token function\">AWSS3StoragePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            Amplify<span class=\"token punctuation\">.</span><span class=\"token function\">addPlugin</span><span class=\"token punctuation\">(</span><span class=\"token function\">AmazonPinpointAnalyticsPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            Amplify<span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n\n            Log<span class=\"token punctuation\">.</span><span class=\"token function\">i</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"aws mobile client init done!\"</span></span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> Throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            Log<span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"initialize onResult exception: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">e<span class=\"token punctuation\">.</span>message</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        Amplify<span class=\"token punctuation\">.</span>Analytics<span class=\"token punctuation\">.</span><span class=\"token function\">recordEvent</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"amplfiy configured\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">getPinpointManager</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> PinpointManager <span class=\"token punctuation\">{</span>\n        pinpointManager<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">let</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> it\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">initAWSMobileClient</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> pinpointConfig <span class=\"token operator\">=</span> <span class=\"token function\">PinpointConfiguration</span><span class=\"token punctuation\">(</span>\n            applicationContext<span class=\"token punctuation\">,</span>\n            AWSMobileClient<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">AWSConfiguration</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> pm <span class=\"token operator\">=</span> <span class=\"token function\">PinpointManager</span><span class=\"token punctuation\">(</span>pinpointConfig<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> pm<span class=\"token punctuation\">.</span><span class=\"token function\">also</span> <span class=\"token punctuation\">{</span> pinpointManager <span class=\"token operator\">=</span> it <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"splashactivityを変更\" style=\"position:relative;\"><a href=\"#splashactivity%E3%82%92%E5%A4%89%E6%9B%B4\" aria-label=\"splashactivityを変更 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SplashActivityを変更</h3>\n<p>アプリを起動すると、firebaseにデバイスごとのinstance idとtokenが作成されます。<br>\nPinpointからPush通知を配信するためにはtokenをPinpointに登録する必要があるのでその処理をSplashActivityに追加します。</p>\n<div class=\"gatsby-code-title\">SplashActivity.kt</div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>amplifytutorial\n\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>Intent\n<span class=\"token keyword\">import</span> androidx<span class=\"token punctuation\">.</span>appcompat<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>AppCompatActivity\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>os<span class=\"token punctuation\">.</span>Bundle\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Log\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobileconnectors<span class=\"token punctuation\">.</span>s3<span class=\"token punctuation\">.</span>transferutility<span class=\"token punctuation\">.</span>TransferNetworkLossHandler\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>firebase<span class=\"token punctuation\">.</span>iid<span class=\"token punctuation\">.</span>FirebaseInstanceId\n<span class=\"token keyword\">import</span> kotlinx<span class=\"token punctuation\">.</span>coroutines<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n\n<span class=\"token keyword\">class</span> SplashActivity <span class=\"token operator\">:</span> <span class=\"token function\">AppCompatActivity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> CoroutineScope <span class=\"token keyword\">by</span> <span class=\"token function\">MainScope</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> TAG <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"SplashActivity\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token operator\">:</span> Bundle<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span>savedInstanceState<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">setContentView</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">.</span>layout<span class=\"token punctuation\">.</span>activity_splash<span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">initializeAWS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onDestroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onDestroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">initializeAWS</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>Dispatchers<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n            AWSUtils<span class=\"token punctuation\">.</span><span class=\"token function\">initAWSMobileClient</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n            AWSUtils<span class=\"token punctuation\">.</span><span class=\"token function\">configureAmplifyPlugin</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">val</span> pinpointManager <span class=\"token operator\">=</span> AWSUtils<span class=\"token punctuation\">.</span><span class=\"token function\">getPinpointManager</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n\n\n            TransferNetworkLossHandler<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n\n            FirebaseInstanceId<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>instanceId<span class=\"token punctuation\">.</span><span class=\"token function\">addOnCompleteListener</span> <span class=\"token punctuation\">{</span> task <span class=\"token operator\">-></span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>task<span class=\"token punctuation\">.</span>isSuccessful<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    Log<span class=\"token punctuation\">.</span><span class=\"token function\">e</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"getInstanceId failed\"</span></span><span class=\"token punctuation\">,</span> task<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n                task<span class=\"token punctuation\">.</span>result<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">let</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">val</span> id <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span>id\n                    <span class=\"token keyword\">val</span> token <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span>token\n                    Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"id: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">id</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n                    Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"token: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">token</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n                    pinpointManager<span class=\"token punctuation\">.</span>notificationClient<span class=\"token punctuation\">.</span><span class=\"token function\">registerDeviceToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token keyword\">val</span> intent <span class=\"token operator\">=</span> <span class=\"token function\">Intent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token label symbol\">@SplashActivity</span><span class=\"token punctuation\">,</span> MainActivity<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span>\n                <span class=\"token function\">startActivity</span><span class=\"token punctuation\">(</span>intent<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"pushlistenerserviceクラスを作成\" style=\"position:relative;\"><a href=\"#pushlistenerservice%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90\" aria-label=\"pushlistenerserviceクラスを作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PushListenerServiceクラスを作成</h3>\n<p>PushListenerServiceを新しく作成し、PushListenerServie.ktを以下のように変更します。</p>\n<div class=\"gatsby-code-title\">PushListenerService</div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>amplifytutorial\n\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>NotificationChannel\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>NotificationManager\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>Context\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>os<span class=\"token punctuation\">.</span>Build\n<span class=\"token keyword\">import</span> android<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Log\n<span class=\"token keyword\">import</span> androidx<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>NotificationCompat\n<span class=\"token keyword\">import</span> androidx<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span>NotificationManagerCompat\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobileconnectors<span class=\"token punctuation\">.</span>pinpoint<span class=\"token punctuation\">.</span>targeting<span class=\"token punctuation\">.</span>notification<span class=\"token punctuation\">.</span>NotificationClient\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobileconnectors<span class=\"token punctuation\">.</span>pinpoint<span class=\"token punctuation\">.</span>targeting<span class=\"token punctuation\">.</span>notification<span class=\"token punctuation\">.</span>NotificationClient<span class=\"token punctuation\">.</span>CampaignPushResult\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>mobileconnectors<span class=\"token punctuation\">.</span>pinpoint<span class=\"token punctuation\">.</span>targeting<span class=\"token punctuation\">.</span>notification<span class=\"token punctuation\">.</span>NotificationDetails\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>firebase<span class=\"token punctuation\">.</span>messaging<span class=\"token punctuation\">.</span>FirebaseMessagingService\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>firebase<span class=\"token punctuation\">.</span>messaging<span class=\"token punctuation\">.</span>RemoteMessage\n\n\n<span class=\"token keyword\">class</span> PushListenerService <span class=\"token operator\">:</span> <span class=\"token function\">FirebaseMessagingService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> TAG <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"PushListenerService\"</span></span>\n        <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> CHANNEL_ID <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"Default Channel\"</span></span>\n        <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> NOTIFICATION_ID <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> TITLE_KEY <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"pinpoint.notification.title\"</span></span>\n        <span class=\"token keyword\">const</span> <span class=\"token keyword\">val</span> BODY_KEY <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"pinpoint.notification.body\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token comment\">// tokenが更新された場合、それをPinpointに通知する必要がある。</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onNewToken</span><span class=\"token punctuation\">(</span>token<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onNewToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n\n        Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"Registering push notifications token: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">token</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n        AWSUtils<span class=\"token punctuation\">.</span><span class=\"token function\">getPinpointManager</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span>notificationClient<span class=\"token punctuation\">.</span><span class=\"token function\">registerDeviceToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Pinpointから送られてくるメッセージはnotificationではなくdata以下に格納されているため、</span>\n    <span class=\"token comment\">// アプリがバックグランドでもフォアグラウンドpush通知処理を自分で書かなければならない。</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onMessageReceived</span><span class=\"token punctuation\">(</span>remoteMessage<span class=\"token operator\">:</span> RemoteMessage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onMessageReceived</span><span class=\"token punctuation\">(</span>remoteMessage<span class=\"token punctuation\">)</span>\n\n        Log<span class=\"token punctuation\">.</span><span class=\"token function\">d</span><span class=\"token punctuation\">(</span>TAG<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"Message: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">remoteMessage<span class=\"token punctuation\">.</span>data</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> notificationClient <span class=\"token operator\">=</span> AWSUtils<span class=\"token punctuation\">.</span><span class=\"token function\">getPinpointManager</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>notificationClient\n\n        <span class=\"token keyword\">val</span> notificationDetails <span class=\"token operator\">=</span> NotificationDetails<span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>remoteMessage<span class=\"token punctuation\">.</span>from<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">mapData</span><span class=\"token punctuation\">(</span>remoteMessage<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">intentAction</span><span class=\"token punctuation\">(</span>NotificationClient<span class=\"token punctuation\">.</span>FCM_INTENT_ACTION<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">val</span> pushResult <span class=\"token operator\">=</span>\n            notificationClient<span class=\"token punctuation\">.</span><span class=\"token function\">handleCampaignPush</span><span class=\"token punctuation\">(</span>notificationDetails<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>CampaignPushResult<span class=\"token punctuation\">.</span>NOT_HANDLED <span class=\"token operator\">!=</span> pushResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>CampaignPushResult<span class=\"token punctuation\">.</span>APP_IN_FOREGROUND <span class=\"token operator\">==</span> pushResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">//                 アプリがforegroundで実行されていた場合は自分でnotification処理を書かなければならない</span>\n                <span class=\"token function\">createNotification</span><span class=\"token punctuation\">(</span>remoteMessage<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">createNotification</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">data</span><span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> String<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Build<span class=\"token punctuation\">.</span>VERSION<span class=\"token punctuation\">.</span>SDK_INT <span class=\"token operator\">>=</span> Build<span class=\"token punctuation\">.</span>VERSION_CODES<span class=\"token punctuation\">.</span>O<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> name <span class=\"token operator\">=</span> CHANNEL_ID\n            <span class=\"token keyword\">val</span> descriptionText <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"サーバーからの通知\"</span></span>\n            <span class=\"token keyword\">val</span> importance <span class=\"token operator\">=</span> NotificationManager<span class=\"token punctuation\">.</span>IMPORTANCE_DEFAULT\n            <span class=\"token keyword\">val</span> channel <span class=\"token operator\">=</span> <span class=\"token function\">NotificationChannel</span><span class=\"token punctuation\">(</span>CHANNEL_ID<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> importance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n                description <span class=\"token operator\">=</span> descriptionText\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">val</span> notificationManager<span class=\"token operator\">:</span> NotificationManager <span class=\"token operator\">=</span>\n                <span class=\"token function\">getSystemService</span><span class=\"token punctuation\">(</span>Context<span class=\"token punctuation\">.</span>NOTIFICATION_SERVICE<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> NotificationManager\n            notificationManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNotificationChannel</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">val</span> notification <span class=\"token operator\">=</span> NotificationCompat<span class=\"token punctuation\">.</span><span class=\"token function\">Builder</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">,</span> CHANNEL_ID<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setContentTitle</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">data</span><span class=\"token punctuation\">[</span>TITLE_KEY<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setStyle</span><span class=\"token punctuation\">(</span>NotificationCompat<span class=\"token punctuation\">.</span><span class=\"token function\">BigTextStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bigText</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">data</span><span class=\"token punctuation\">[</span>BODY_KEY<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setSmallIcon</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">.</span>mipmap<span class=\"token punctuation\">.</span>ic_launcher<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setPriority</span><span class=\"token punctuation\">(</span>NotificationCompat<span class=\"token punctuation\">.</span>PRIORITY_DEFAULT<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        NotificationManagerCompat<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span>NOTIFICATION_ID<span class=\"token punctuation\">,</span> notification<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"amplifyconfigurationjsonを修正\" style=\"position:relative;\"><a href=\"#amplifyconfigurationjson%E3%82%92%E4%BF%AE%E6%AD%A3\" aria-label=\"amplifyconfigurationjsonを修正 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>amplifyconfiguration.jsonを修正。</h3>\n<p>ここで一度アプリをビルドしてみてください。<br>\nビルド出来れば問題ありませんが、当ブログ運営者の環境では以下のようなエラーを出力してクラッシュしました。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">E/AWSUtils: initialize onResult exception: Attempt to invoke virtual method 'org.json.JSONObject org.json.JSONObject.getJSONObject(java.lang.String)' on a null object reference\nE/AndroidRuntime: FATAL EXCEPTION: DefaultDispatcher-worker-2\n    Process: com.example.amplifytutorial, PID: 8440\n    java.lang.IllegalStateException: This category is not yet configured.Make sure you added it with Amplify.addPlugin and then called Amplify.config\n        at com.amplifyframework.core.category.Category.getSelectedPlugin(Category.java:137)\n        at com.amplifyframework.analytics.AnalyticsCategory.recordEvent(AnalyticsCategory.java:84)\n        at com.example.amplifytutorial.AWSUtils.configureAmplifyPlugin(AWSUtils.kt:73)\n        at com.example.amplifytutorial.SplashActivity$initializeAWS$1.invokeSuspend(SplashActivity.kt:34)\n        at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)\n        at kotlinx.coroutines.DispatchedTask.run(Dispatched.kt:241)\n        at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:594)\n        at kotlinx.coroutines.scheduling.CoroutineScheduler.access$runSafely(CoroutineScheduler.kt:60)\n        at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:740)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>いままで説明を省略していたのですが、amplifyはAWSのバックエンドにアクセスするための設定をres/rawディレクトリ以下に格納してます。<br>\nどうやら、ここで設定されているjsonオブジェクトに対して存在しないキーでアクセスしようとしているため、pluginの初期化が上手く出来ていないようです。</p>\n<p>アプリがビルドできるようにamplifyconfigure.jsonを以下のように書き換えます。</p>\n<div class=\"gatsby-code-title\">amplifyconfigure.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\">-            <span class=\"token property\">\"awsPinpointAnalyticsPlugin\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\n+            <span class=\"token property\">\"amazonPinpointAnalyticsPlugin\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>amplify-android-sdkはまだプレビューですので、こういったバグは他の場所にもあるかもしれないですね。</p>\n<h2 id=\"lamdba関数を作成\" style=\"position:relative;\"><a href=\"#lamdba%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%9C%E6%88%90\" aria-label=\"lamdba関数を作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lamdba関数を作成</h2>\n<p>これでAndroid側の実装は全て終了です。<br>\nあとは、Pinpointにpush通知を依頼するlamdba関数を作成するだけです。<br>\n今回は簡略化のため、S3に任意のオブジェクトが作成された場合に、全てのエンドポイントに対してpush通知を送信するとさせていただきます。\nまたlamdba関数はnode.jsで作成します。</p>\n<p>AWS Lamdbaのwebコンソールを開き、以下の設定でlamdba関数を作成しましょう。</p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>関数名</td>\n<td>AmplifyTutorialPushNotification</td>\n</tr>\n<tr>\n<td>ランタイム</td>\n<td>Node.js 12.x</td>\n</tr>\n</tbody>\n</table>\n<p>S3のWebコンソール画面のプロパティでlamdba関数とeventを紐付けます。</p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>名前</td>\n<td>ImageUploadEvent</td>\n</tr>\n<tr>\n<td>イベント</td>\n<td>すべてのオブジェクト作成イベント</td>\n</tr>\n<tr>\n<td>送信先</td>\n<td>Lamdba関数</td>\n</tr>\n<tr>\n<td>Lamdba</td>\n<td>AmplifyTutorialPushNotification</td>\n</tr>\n</tbody>\n</table>\n<p>Lamdba関数がPinpointにアクセスできるようにiamロールにポリシーを付け加えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"VisualEditor0\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mobiletargeting:CreateCampaign\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:mobiletargeting:&lt;region>:&lt;account id>:apps/&lt;app id>\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>今回はPinpointのWebコンソールであらかじめSegmentを作成しておきます。<br>\nコンソール画面のSegmentsからCreate Segmentを選択し、NameにAllUsersを入力し、他は初期設定のままで作成します。</p>\n<p>javascriptでpinpointにpush通知を依頼する処理を書き、アップロードします。<br>\nsegment idは以下のコマンドで取得できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ aws pinpoint  get-segments <span class=\"token parameter variable\">--region</span> <span class=\"token operator\">&lt;</span>region<span class=\"token operator\">></span> --application-id <span class=\"token operator\">&lt;</span>app id<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>javascriptコードは以下の通りです。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aws-sdk\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> pinpoint <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>Pinpoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">region</span><span class=\"token operator\">:</span> <span class=\"token string\">\"us-west-2\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">ApplicationId</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;project id>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">WriteCampaignRequest</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">MessageConfiguration</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">ADMMessage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">Action</span><span class=\"token operator\">:</span> <span class=\"token string\">\"OPEN_APP\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message from lamdba\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">APNSMessage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">Action</span><span class=\"token operator\">:</span> <span class=\"token string\">\"OPEN_APP\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message from lamdba\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">BaiduMessage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">Action</span><span class=\"token operator\">:</span> <span class=\"token string\">\"OPEN_APP\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message from lamdba\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">GCMMessage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">Action</span><span class=\"token operator\">:</span> <span class=\"token string\">\"OPEN_APP\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">Title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message from lamdba\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">Name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Campaign form lambda\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">Schedule</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">IsLocalTime</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">StartTime</span><span class=\"token operator\">:</span> <span class=\"token string\">\"IMMEDIATE\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">Timezone</span><span class=\"token operator\">:</span> <span class=\"token string\">\"UTC\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">SegmentId</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;segment id>\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">SegmentVersion</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">formatString</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">date<span class=\"token punctuation\">,</span> format</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  format <span class=\"token operator\">=</span> format<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">YYYY</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  format <span class=\"token operator\">=</span> format<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">MM</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  format <span class=\"token operator\">=</span> format<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">DD</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  format <span class=\"token operator\">=</span> format<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">hh</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  format <span class=\"token operator\">=</span> format<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">mm</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  format <span class=\"token operator\">=</span> format<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">ss</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> format<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> s3 <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">\"Records\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"s3\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> bucketName <span class=\"token operator\">=</span> s3<span class=\"token punctuation\">[</span><span class=\"token string\">\"bucket\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> date <span class=\"token operator\">=</span> <span class=\"token function\">formatString</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"YYYY/MM/DD hh:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>date<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\nバケット </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bucketName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 内に、ファイルが新しく作成されました。</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  params<span class=\"token punctuation\">[</span><span class=\"token string\">\"WriteCampaignRequest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"MessageConfiguration\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"GCMMessage\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"Body\"</span>\n  <span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> body<span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> pinpoint<span class=\"token punctuation\">.</span><span class=\"token function\">createCampaign</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">statusCode</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"デモ\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%A2\" aria-label=\"デモ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>デモ</h2>\n<p>これで、画像をアップロードしたタイミングでpush通知が届くようになりました。<br>\n実際にアプリを起動して、写真を撮影し、S3へアップロードしてみてください。</p>\n<p>バケット内にオブジェクトが作成されたというメッセージが届くかと思います。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>駆け足ではありましたが以上で、AmplifyとAndroidでログインとファイル保存とPush通知のtutorialシリーズは終了です。<br>\namplify-android-sdk自体はまだ発表されて間もないので、これから様々な機能が追加されていくことに期待したいですね。<br>\n今後は、Pinpointの各機能をより深く掘り下げていけたらなと考えいています。</p>\n<p>自分はまだandroidアプリもawsも知識不足なので、至るところにお見苦しい点があったかと思いますが、最後まで読んで頂き本当にありがとうございました。</p>\n<h2 id=\"参考リンク\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\" aria-label=\"参考リンク permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考リンク</h2>\n<ul>\n<li><a href=\"https://firebase.google.com/docs/projects/learn-more?hl=ja\">Firebase プロジェクトについて理解する</a></li>\n<li><a href=\"https://firebase.google.com/docs/android/setup?hl=ja\">Android プロジェクトに Firebase を追加する</a></li>\n<li><a href=\"https://docs.aws.amazon.com/ja_jp/pinpoint/latest/developerguide/welcome.html\">AWS - Amazon Pinpoint とは</a></li>\n<li><a href=\"https://aws-amplify.github.io/docs/sdk/android/push-notifications\">Android SDK - Push Notifications</a></li>\n<li><a href=\"https://aws-amplify.github.io/docs/sdk/android/push-notifications-setup-fcm\">Android SDK - Setting Up FCM/GCM for Push Notifications</a></li>\n</ul>","toc":"<ul>\n<li>\n<p><a href=\"#%E3%81%93%E3%82%8C%E3%81%AF%E4%BD%95\">これは何</a></p>\n</li>\n<li>\n<p><a href=\"#firebase%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90\">firebaseプロジェクトを作成</a></p>\n</li>\n<li>\n<p><a href=\"#amplify%E3%81%ABanalytics%E6%A9%9F%E8%83%BD%E3%82%92%E8%BF%BD%E5%8A%A0\">AmplifyにAnalytics機能を追加</a></p>\n</li>\n<li>\n<p><a href=\"#android%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85\">Android側の実装</a></p>\n<ul>\n<li><a href=\"#gradle%E3%81%AB%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E8%BF%BD%E5%8A%A0\">gradleに依存関係を追加</a></li>\n<li><a href=\"#androidmanifest%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0\">AndroidManifestファイルに設定を追加</a></li>\n<li><a href=\"#awsutils%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4\">AWSUtilsクラスを変更</a></li>\n<li><a href=\"#splashactivity%E3%82%92%E5%A4%89%E6%9B%B4\">SplashActivityを変更</a></li>\n<li><a href=\"#pushlistenerservice%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90\">PushListenerServiceクラスを作成</a></li>\n<li><a href=\"#amplifyconfigurationjson%E3%82%92%E4%BF%AE%E6%AD%A3\">amplifyconfiguration.jsonを修正。</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#lamdba%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%9C%E6%88%90\">Lamdba関数を作成</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%83%87%E3%83%A2\">デモ</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\">参考リンク</a></p>\n</li>\n</ul>"},"site":{"siteMetadata":{"siteUrl":"https://www.takigawa-memo.com"}}},"pageContext":{"slug":"/amplify-android-pinpoint/"}},"staticQueryHashes":["112949366","706912905"]}